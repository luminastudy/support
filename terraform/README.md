# Lumina Support Site - Terraform Infrastructure

This directory contains Terraform configuration for deploying the Lumina Support documentation site to AWS.

## Architecture

- **S3 Bucket**: Stores static files generated by Docusaurus
- **CloudFront**: CDN distribution with HTTPS (using existing wildcard certificate)
- **GitHub Actions OIDC**: Secure deployment without long-lived credentials

## Prerequisites

1. AWS CLI configured with appropriate credentials
2. Terraform >= 1.0 installed
3. Existing wildcard ACM certificate for `*.lumina.study` in us-east-1
4. Existing GitHub OIDC provider (created by landing terraform)

## Usage

### Initialize and Apply

```bash
cd terraform
terraform init
terraform plan
terraform apply
```

### After Applying

1. **Create DNS Record**: Add CNAME record for `support.lumina.study` pointing to the CloudFront distribution domain (shown in outputs)

2. **Configure GitHub Secrets**: Add to the support repository:
   - `AWS_ROLE_ARN`: IAM role ARN from outputs
   - `CLOUDFRONT_DISTRIBUTION_ID`: Distribution ID from outputs

3. **Push to Deploy**: Push to main branch to trigger CI/CD deployment

## Cost Optimization

- Uses `PriceClass_100` (US, Canada, Europe only) - cheapest CloudFront tier
- S3 with private access (no public endpoints)
- Pay-per-request model

## Files

- `providers.tf` - AWS provider configuration
- `variables.tf` - Input variables
- `backend.tf` - Terraform state backend
- `cloudfront.tf` - S3 bucket and CloudFront distribution
- `github-actions.tf` - IAM role for GitHub Actions OIDC
- `outputs.tf` - Output values
